/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
function comboSelectValue(f,d){var b=f.getElementsByTagName("option");for(var a=b.length;--a>=0;){var e=b[a];e.selected=(e.value==d)}f.value=d}function i18n(a){return Xinha._lc(a,"ExtendedFileManager")}function setAlign(c){var a=document.getElementById("f_align");for(var b=0;b<a.length;b++){if(a.options[b].value==c){a.selectedIndex=b;break}}}function onTargetChanged(){var a=document.getElementById("f_other_target");if(this.value=="_other"){a.style.visibility="visible";a.select();a.focus()}else{a.style.visibility="hidden"}}function init(){if(typeof imgManager=="undefined"){setTimeout(init,10);return}var s=650;var z=600;window.resizeTo(s,z);var j=Xinha.pageSize(window);window.resizeTo(s,z);var u=Xinha.viewportSize(window);window.resizeBy(0,j.y-u.y+5);u=Xinha.viewportSize(window);if(!Xinha.is_ie){var r=opener.screenX+(opener.outerWidth-u.x)/2;var q=opener.screenY+(opener.outerHeight-u.x)/2}else{var r=(self.screen.availWidth-u.x)/2;var q=(self.screen.availHeight-u.y)/2}window.moveTo(r,q);__xinha_dlg_init();__dlg_translate("ExtendedFileManager");var f=document.getElementById("uploadForm");if(f){f.target="imgManager"}var n=window.dialogArguments.editor;var l=window.dialogArguments.param;var m=null;if(manager_mode=="image"&&l){var e=new RegExp("^https?://");if(l.f_url.length>0&&!e.test(l.f_url)&&typeof l.baseHref=="string"){l.f_url=l.baseHref+l.f_url}var A=new RegExp("(https?://[^/]*)?"+base_url.replace(/\/$/,""));l.f_url=l.f_url.replace(A,"");var t=(_resized_dir)?_resized_dir.replace(Xinha.RE_Specials,"\\$1")+"/":"";var p=_resized_prefix.replace(Xinha.RE_Specials,"\\$1");var d=new RegExp("^(.*/)"+t+p+"_([0-9]+)x([0-9]+)_([^/]+)$");var o=l.f_url.match(d);if(d.test(l.f_url)){l.f_url=RegExp.$1+RegExp.$4;l.f_width=RegExp.$2;l.f_height=RegExp.$3}document.getElementById("f_url").value=l.f_url;document.getElementById("f_alt").value=l.f_alt;document.getElementById("f_title").value=l.f_title;document.getElementById("f_border").value=l.f_border;document.getElementById("f_width").value=l.f_width;document.getElementById("f_height").value=l.f_height;document.getElementById("f_margin").value=l.f_margin;document.getElementById("f_padding").value=l.f_padding;document.getElementById("f_borderColor").value=l.f_borderColor;document.getElementById("f_backgroundColor").value=l.f_backgroundColor;setAlign(l.f_align);document.getElementById("f_url").focus();document.getElementById("orginal_width").value=l.f_width;document.getElementById("orginal_height").value=l.f_height;var d=new RegExp("^(.*/)([^/]+)$");if(d.test(l.f_url)){m=RegExp.$1}document.getElementById("f_preview").src=_backend_url+"__function=thumbs&img="+l.f_url}else{if(manager_mode=="link"&&l){var k=document.getElementById("f_target");var e=new RegExp("^https?://");if(l.f_href.length>0&&!e.test(l.f_href)&&typeof l.baseHref=="string"){l.f_href=l.baseHref+l.f_href}var a=new RegExp("(https?://[^/]*)?"+base_url.replace(/\/$/,""));l.f_href=l.f_href.replace(a,"");var d=new RegExp("^(.*/)([^/]+)$");if(d.test(l.f_href)){m=RegExp.$1}else{m=document.cookie.match(/EFMStartDirlink=(.*?)(;|$)/);if(m){m=m[1]}}if(l){if(typeof l.f_href!="undefined"){document.getElementById("f_href").value=l.f_href;document.getElementById("f_title").value=l.f_title;comboSelectValue(k,l.f_target);if(k.value!=l.f_target){var b=document.createElement("option");b.value=l.f_target;b.innerHTML=b.value;k.appendChild(b);b.selected=true}}}if(l.f_usetarget==false||manager_show_target!=false){document.getElementById("f_target_label").style.visibility="hidden";document.getElementById("f_target").style.visibility="hidden";document.getElementById("f_other_target").style.visibility="hidden"}if(k&&l.f_usetarget&&manager_show_target!=false){var b=document.createElement("option");b.value="_other";b.innerHTML=i18n("Other");k.appendChild(b);k.onchange=onTargetChanged}document.getElementById("f_href").focus()}else{if(!l){m=document.cookie.match(new RegExp("EFMStartDir"+manager_mode+"=(.*?)(;|$)"));if(m){m=m[1]}}}}if(m){iframeUrl+="&dir="+m;var c=document.getElementById("dirPath");for(var v=0;v<c.options.length;v++){if(c.options[v].value==encodeURIComponent(m)){c.options[v].selected=true;break}}}imgManager.location.replace(iframeUrl);if(manager_mode=="image"&&typeof Xinha.colorPicker!="undefined"&&document.getElementById("f_backgroundColor")&&document.getElementById("f_backgroundColor").type=="text"){var g={cellsize:n.config.colorPickerCellSize,granularity:n.config.colorPickerGranularity,websafe:n.config.colorPickerWebSafe,savecolors:n.config.colorPickerSaveColors};new Xinha.colorPicker.InputBinding(document.getElementById("f_backgroundColor"),g);new Xinha.colorPicker.InputBinding(document.getElementById("f_borderColor"),g)}setTimeout(function(){resize();addEvent(window,"resize",resize)},500)}function pasteButton(b){var e=document.getElementById("pasteBtn");if(!e.firstChild){var c=document.createElement("a");c.href="javascript:void(0);";var d=document.createElement("img");d.src=window.opener.Xinha.getPluginDir("ExtendedFileManager")+"/img/edit_paste.gif";d.alt=i18n("Paste");c.appendChild(d);e.appendChild(c)}e.onclick=function(){if(typeof imgManager!="undefined"){imgManager.paste(b)}if(b.action=="moveFile"||b.action=="moveDir"){this.onclick=null;this.removeChild(this.firstChild)}};switch(b.action){case"copyFile":e.firstChild.title=i18n('Copy "$file='+b.file+'$" from "$dir='+decodeURIComponent(b.dir)+'$" here');break;case"copyDir":e.firstChild.title=i18n('Copy folder "$file='+b.file+'$" from "$dir='+decodeURIComponent(b.dir)+'$" here');break;case"moveFile":e.firstChild.title=i18n('Move "$file='+b.file+'$" from "$dir='+decodeURIComponent(b.dir)+'$" here');break;break;case"moveDir":e.firstChild.title=i18n('Move folder "$file='+b.file+'$" from "$dir='+decodeURIComponent(b.dir)+'$" here');break}}function onCancel(){__dlg_close(null);return false}function onOK(){if(manager_mode=="image"){var fields=["f_url","f_alt","f_title","f_align","f_border","f_margin","f_padding","f_height","f_width","f_borderColor","f_backgroundColor"];var param=new Object();for(var i in fields){var id=fields[i];var el=document.getElementById(id);if(id=="f_url"&&el.value.indexOf("://")<0&&el.value){param[id]=makeURL(base_url,el.value)}else{param[id]=el.value}}var origsize={w:document.getElementById("orginal_width").value,h:document.getElementById("orginal_height").value};if((origsize.w!=param.f_width)||(origsize.h!=param.f_height)){var resized=Xinha._geturlcontent(window.opener.Xinha.getPluginDir("ExtendedFileManager")+"/"+_backend_url+"&__function=resizer&img="+encodeURIComponent(document.getElementById("f_url").value)+"&width="+param.f_width+"&height="+param.f_height);resized=eval(resized);if(resized){param.f_url=makeURL(base_url,resized)}}__dlg_close(param);return false}else{if(manager_mode=="link"){var required={};for(var i in required){var el=document.getElementById(i);if(!el.value){alert(required[i]);el.focus();return false}}var fields=["f_href","f_title","f_target"];var param=new Object();for(var i in fields){var id=fields[i];var el=document.getElementById(id);if(id=="f_href"&&el.value.indexOf("://")<0){param[id]=makeURL(base_url,el.value)}else{param[id]=el.value}}if(param.f_target=="_other"){param.f_target=document.getElementById("f_other_target").value}__dlg_close(param);return false}}}function makeURL(b,a){if(b.substring(b.length-1)!="/"){b+="/"}if(a.charAt(0)=="/"){}a=a.substring(1);return b+a}function updateDir(a){var b=a.options[a.selectedIndex].value;changeDir(b)}function goUpDir(){var a=document.getElementById("dirPath");var g=a.options[a.selectedIndex].text;if(g.length<2){return false}var e=g.split("/");var c="";for(var d=0;d<e.length-2;d++){c+=e[d]+"/"}for(var d=0;d<a.length;d++){var b=a.options[d].text;if(b==c){a.selectedIndex=d;var f=a.options[d].value;changeDir(f);break}}}function changeDir(a){if(typeof imgManager!="undefined"){imgManager.changeDir(a)}}function updateView(){refresh()}function toggleConstrains(b){var a=document.getElementById("imgLock");var b=document.getElementById("constrain_prop");if(b.checked){a.src="img/locked.gif";checkConstrains("width")}else{a.src="img/unlocked.gif"}}function checkConstrains(f){var g=document.getElementById("constrain_prop");if(g.checked){var e=document.getElementById("orginal_width");var h=parseInt(e.value);var e=document.getElementById("orginal_height");var d=parseInt(e.value);var c=document.getElementById("f_width");var a=document.getElementById("f_height");var b=parseInt(c.value);var i=parseInt(a.value);if(h>0&&d>0){if(f=="width"&&b>0){a.value=parseInt((b/h)*d)}if(f=="height"&&i>0){c.value=parseInt((i/d)*h)}}}}function showMessage(b){var c=document.getElementById("message");var a=document.getElementById("messages");if(c.firstChild){c.removeChild(c.firstChild)}c.appendChild(document.createTextNode(i18n(b)));a.style.display="block"}function addEvent(d,a,b){if(d.addEventListener){d.addEventListener(a,b,true);return true}else{if(d.attachEvent){var c=d.attachEvent("on"+a,b);return c}else{return false}}}function doUpload(){var a=document.getElementById("uploadForm");if(a){showMessage("Uploading")}}function refresh(){var a=document.getElementById("dirPath");updateDir(a)}function newFolder(){function b(c){var d=document.getElementById("dirPath");var e=d.options[d.selectedIndex].value;if(c==thumbdir){alert(i18n("Invalid folder name, please choose another folder name."));return false}if(c&&c!=""&&typeof imgManager!="undefined"){imgManager.newFolder(e,encodeURI(c))}}if(Xinha.ie_version>6){popupPrompt(i18n("Please enter name for new folder..."),i18n("Untitled"),b,i18n("New Folder"))}else{var a=prompt(i18n("Please enter name for new folder..."),i18n("Untitled"));b(a)}}function resize(){var c=Xinha.viewportSize(window);var a=document.getElementById("messages");var b=(a&&a.style.display!="none")?parseInt(document.getElementById("messages").offsetHeight,10):0;document.getElementById("imgManager").style.height=parseInt(c.y-130-document.getElementById("controls").offsetHeight,10)-b+"px";return true}Xinha.addOnloadHandler(init,window);