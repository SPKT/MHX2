/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
Xinha.Config.prototype.css_style={};Xinha.Config.prototype.stylistLoadStylesheet=function(c,f,e){if(!f){f={}}var b=Xinha.ripStylesFromCSSFile(c,e);for(var d in b){if(f[d]){this.css_style[d]=f[d]}else{this.css_style[d]=b[d]}}for(var a=0;a<this.pageStyleSheets.length;a++){if(this.pageStyleSheets[a]==c){return}}this.pageStyleSheets[this.pageStyleSheets.length]=c};Xinha.Config.prototype.stylistLoadStyles=function(b,f,e,d){if(!f){f={}}var a=Xinha.ripStylesFromCSSString(b,e);for(var c in a){if(f[c]){this.css_style[c]=f[c]}else{this.css_style[c]=a[c]}}this.pageStyle+=b};Xinha.prototype._fillStylist=function(){if(!this.plugins.Stylist.instance.dialog){return false}var h=this.plugins.Stylist.instance.dialog.main;h.innerHTML="";var j=true;var d=this._getSelection();var b=this._activeElement(d);for(var l in this.config.css_style){var m=null;var a=l.trim();var i=true;var f=b;if(i&&/[^a-zA-Z0-9_.-]/.test(a)){i=false}if(a.indexOf(".")<0){i=false}if(i&&(a.indexOf(".")>0)){m=a.substring(0,a.indexOf(".")).toLowerCase();a=a.substring(a.indexOf("."),a.length);if(b!=null&&b.tagName.toLowerCase()==m){i=true;f=b}else{if(this._getFirstAncestor(this._getSelection(),[m])!=null){i=true;f=this._getFirstAncestor(this._getSelection(),[m])}else{if((m=="div"||m=="span"||m=="p"||(m.substr(0,1)=="h"&&m.length==2&&m!="hr"))){if(!this._selectionEmpty(this._getSelection())){i=true;f="new"}else{f=this._getFirstAncestor(d,["p","h1","h2","h3","h4","h5","h6","h7"]);if(f!=null){i=true}else{i=false}}}else{i=false}}}}if(i){a=a.substring(a.indexOf("."),a.length);a=a.replace("."," ");if(f==null){if(this._selectionEmpty(this._getSelection())){f=this._getFirstAncestor(this._getSelection(),null)}else{f="new";m="span"}}}var g=(this._ancestorsWithClasses(d,m,a).length>0?true:false);var e=this._ancestorsWithClasses(d,m,a);if(i){var k=document.createElement("a");k.onfocus=function(){this.blur()};k._stylist_className=a.trim();k._stylist_applied=g;k._stylist_appliedTo=e;k._stylist_applyTo=f;k._stylist_applyTag=m;k.innerHTML=this.config.css_style[l];k.href="javascript:void(0)";var c=this;k.onclick=function(){if(this._stylist_applied==true){c._stylistRemoveClasses(this._stylist_className,this._stylist_appliedTo)}else{c._stylistAddClasses(this._stylist_applyTo,this._stylist_applyTag,this._stylist_className)}return false};k.style.display="block";k.style.paddingLeft="3px";k.style.paddingTop="1px";k.style.paddingBottom="1px";k.style.textDecoration="none";if(g){k.style.background="Highlight";k.style.color="HighlightText"}k.style.position="relative";h.appendChild(k)}}};Xinha.prototype._stylistAddClasses=function(c,a,b){if(c=="new"){this.insertHTML("<"+a+' class="'+b+'">'+this.getSelectedHTML()+"</"+a+">")}else{if(a!=null&&c.tagName.toLowerCase()!=a){var d=this.switchElementTag(c,a);if(typeof c._stylist_usedToBe!="undefined"){d._stylist_usedToBe=c._stylist_usedToBe;d._stylist_usedToBe[d._stylist_usedToBe.length]={tagName:c.tagName,className:c.getAttribute("class")}}else{d._stylist_usedToBe=[{tagName:c.tagName,className:c.getAttribute("class")}]}Xinha.addClasses(d,b)}else{Xinha._addClasses(c,b)}}this.focusEditor();this.updateToolbar()};Xinha.prototype._stylistRemoveClasses=function(b,c){for(var a=0;a<c.length;a++){this._stylistRemoveClassesFull(c[a],b)}this.focusEditor();this.updateToolbar()};Xinha.prototype._stylistRemoveClassesFull=function(a,c){if(a!=null){var d=a.className.trim().split(" ");var g=[];var k=c.split(" ");for(var h=0;h<d.length;h++){var l=false;for(var f=0;l==false&&f<k.length;f++){if(k[f]==d[h]){l=true}}if(l==false){g[g.length]=d[h]}}if(g.length==0&&a._stylist_usedToBe&&a._stylist_usedToBe.length>0&&a._stylist_usedToBe[a._stylist_usedToBe.length-1].className!=null){var m=a._stylist_usedToBe[a._stylist_usedToBe.length-1];var j=Xinha.arrayFilter(m.className.trim().split(" "),function(i){if(i==null||i.trim()==""){return false}return true});if((g.length==0)||(Xinha.arrayContainsArray(g,j)&&Xinha.arrayContainsArray(j,g))){a=this.switchElementTag(a,m.tagName);g=j}else{a._stylist_usedToBe=[]}}if(g.length>0||a.tagName.toLowerCase()!="span"||(a.id&&a.id!="")){a.className=g.join(" ").trim()}else{var b=a.parentNode;var e;while(a.hasChildNodes()){if(a.firstChild.nodeType==1){this._stylistRemoveClassesFull(a.firstChild,c)}e=a.removeChild(a.firstChild);b.insertBefore(e,a)}b.removeChild(a)}}};Xinha.prototype.switchElementTag=function(e,c){var d=e.parentNode;var f=this._doc.createElement(c);if(Xinha.is_ie||e.hasAttribute("id")){f.setAttribute("id",e.getAttribute("id"))}if(Xinha.is_ie||e.hasAttribute("style")){f.setAttribute("style",e.getAttribute("style"))}var b=e.childNodes;for(var a=0;a<b.length;a++){f.appendChild(b[a].cloneNode(true))}d.insertBefore(f,e);f._stylist_usedToBe=[e.tagName];d.removeChild(e);this.selectNodeContents(f);return f};Xinha.prototype._getAncestorsClassNames=function(d){var c=this._activeElement(d);if(c==null){c=(Xinha.is_ie?this._createRange(d).parentElement():this._createRange(d).commonAncestorContainer)}var e=[];while(c){if(c.nodeType==1){var b=c.className.trim().split(" ");for(var a=0;a<b.length;a++){e[e.length]=b[a]}if(c.tagName.toLowerCase()=="body"){break}if(c.tagName.toLowerCase()=="table"){break}}c=c.parentNode}return e};Xinha.prototype._ancestorsWithClasses=function(a,m,c){var j=[];var b=this._activeElement(a);if(b==null){try{b=(Xinha.is_ie?this._createRange(a).parentElement():this._createRange(a).commonAncestorContainer)}catch(h){return j}}var g=c.trim().split(" ");while(b){if(b.nodeType==1&&b.className){if(m==null||b.tagName.toLowerCase()==m){var c=b.className.trim().split(" ");var l=true;for(var f=0;f<g.length;f++){var d=false;for(var k=0;k<c.length;k++){if(g[f]==c[k]){d=true;break}}if(!d){l=false;break}}if(l){j[j.length]=b}}if(b.tagName.toLowerCase()=="body"){break}if(b.tagName.toLowerCase()=="table"){break}}b=b.parentNode}return j};Xinha.ripStylesFromCSSFile=function(a,c){var b=Xinha._geturlcontent(a);return Xinha.ripStylesFromCSSString(b,c,a)};Xinha.ripStylesFromCSSString=function(d,b,c){if(!b){if(!c){c=_editor_url+"Xinha.css"}var a={};function h(q,k){a[k]=true;var l="@import\\s*(url\\()?[\"'](.*)[\"'].*";var j=q.match(new RegExp(l,"ig"));var n,o,r=new RegExp(l,"i");if(j){var s=k.replace(/\?.*$/,"").split("/");s.pop();s=s.join("/");for(var p=0;p<j.length;p++){n=j[p].match(r);o=n[2];if(!o.match(/^([^:]+\:)?\//)){o=Xinha._resolveRelativeUrl(s,o)}if(a[o]){continue}q+=h(Xinha._geturlcontent(o),o)}}return q}d=h(d,c)}var g=/\/\*(.|\r|\n)*?\*\//g;var i=/\{(.|\r|\n)*?\}/g;d=d.replace(g,"");d=d.replace(i,",");d=d.split(",");var f={};for(var e=0;e<d.length;e++){if(d[e].trim()){f[d[e].trim()]=d[e].trim()}}return f};function Stylist(a,b){this.editor=a;var c=this}Stylist._pluginInfo={name:"Stylist",version:"1.0",developer:"James Sleeman",developer_url:"http://www.gogo.co.nz/",c_owner:"Gogo Internet Services",license:"HTMLArea",sponsor:"Gogo Internet Services",sponsor_url:"http://www.gogo.co.nz/"};Stylist.prototype.onGenerateOnce=function(){var a=this.editor.config;if(typeof a.css_style!="undefined"&&Xinha.objectProperties(a.css_style).length!=0){this._prepareDialog()}};Stylist.prototype._prepareDialog=function(){var c=this.editor;var f=this;var e="<h1><l10n>Styles</l10n></h1>";this.dialog=new Xinha.Dialog(c,e,"Stylist",{width:200},{modal:false,closable:false});Xinha._addClass(this.dialog.rootElem,"Stylist");this.dialog.attachToPanel("right");this.dialog.show();var d=this.dialog;var a=this.dialog.main;var b=this.dialog.captionBar;a.style.overflow="auto";a.style.height=this.editor._framework.ed_cell.offsetHeight-b.offsetHeight+"px";c.notifyOn("modechange",function(h,g){if(!d.attached){return}switch(g.mode){case"text":d.hide();break;case"wysiwyg":d.show();break}});c.notifyOn("panel_change",function(i,g){if(!d.attached){return}switch(g.action){case"show":var h=a.offsetHeight-g.panel.offsetHeight;a.style.height=((h>0)?a.offsetHeight-g.panel.offsetHeight:0)+"px";d.rootElem.style.height=b.offsetHeight+"px";c.sizeEditor();break;case"hide":f.resize();break}});c.notifyOn("before_resize",function(){if(!d.attached){return}d.rootElem.style.height=b.offsetHeight+"px"});c.notifyOn("resize",function(){if(!d.attached){return}f.resize()})};Stylist.prototype.resize=function(){var c=this.editor;var e=this.dialog.rootElem;if(e.style.display=="none"){return}var b=e.parentNode;var a=b.offsetHeight;for(var d=0;d<b.childNodes.length;++d){if(b.childNodes[d]==e||!b.childNodes[d].offsetHeight){continue}a-=b.childNodes[d].offsetHeight}e.style.height=a-5+"px";this.dialog.main.style.height=a-this.dialog.captionBar.offsetHeight-5+"px"};Stylist.prototype.onUpdateToolbar=function(){if(this.dialog){if(this._timeoutID){window.clearTimeout(this._timeoutID)}var a=this.editor;this._timeoutID=window.setTimeout(function(){a._fillStylist()},250)}};