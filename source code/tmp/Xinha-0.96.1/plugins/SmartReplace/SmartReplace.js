/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
function SmartReplace(c){this.editor=c;var a=c.config;var b=this;a.registerButton({id:"smartreplace",tooltip:this._lc("SmartReplace"),image:[_editor_url+"iconsets/Tango/ed_buttons_main.png",3,8],textMode:false,action:function(g,f,d){b.buttonPress(null,d)}});a.addToolbarElement("smartreplace","htmlmode",1)}SmartReplace._pluginInfo={name:"SmartReplace",version:"1.0",developer:"Raimund Meyer",developer_url:"http://x-webservice.net",c_owner:"Raimund Meyer",sponsor:"",sponsor_url:"",license:"htmlArea"};SmartReplace.prototype._lc=function(a){return Xinha._lc(a,"SmartReplace")};Xinha.Config.prototype.SmartReplace={defaultActive:true,quotes:null};SmartReplace.prototype.toggleActivity=function(a){if(typeof a!="undefined"){this.active=a}else{this.active=this.active?false:true}this.editor._toolbarObjects.smartreplace.state("active",this.active)};SmartReplace.prototype.onUpdateToolbar=function(){this.editor._toolbarObjects.smartreplace.state("active",this.active)};SmartReplace.prototype.onGenerate=function(){this.active=this.editor.config.SmartReplace.defaultActive;this.editor._toolbarObjects.smartreplace.state("active",this.active);var a=this;Xinha._addEvent(a.editor._doc,"keypress",function(c){return a.keyEvent(Xinha.is_ie?a.editor._iframe.contentWindow.event:c)});var b=this.editor.config.SmartReplace.quotes;if(b&&typeof b=="object"){this.openingQuotes=b[0];this.closingQuotes=b[1];this.openingQuote=b[2];this.closingQuote=b[3]}else{this.openingQuotes=this._lc("OpeningDoubleQuotes");this.closingQuote=this._lc("ClosingSingleQuote");this.closingQuotes=this._lc("ClosingDoubleQuotes");this.openingQuote=this._lc("OpeningSingleQuote")}if(this.openingQuotes=="OpeningDoubleQuotes"){this.openingQuotes=String.fromCharCode(8220);this.closingQuotes=String.fromCharCode(8221);this.openingQuote=String.fromCharCode(8216);this.closingQuote=String.fromCharCode(8217)}};SmartReplace.prototype.keyEvent=function(d){if(!this.active){return true}var b=this.editor;var a=Xinha.is_ie?d.keyCode:d.which;var c=String.fromCharCode(a);if(c=='"'||c=="'"){Xinha._stopEvent(d);return this.smartQuotes(c)}if(a==32){return this.smartReplace(d,2,/^\s-/," "+String.fromCharCode(8211),false)}if(c=="."){return this.smartReplace(d,2,/\.\./,String.fromCharCode(8230),true)}return true};SmartReplace.prototype.smartQuotes=function(c){if(c=="'"){var f=this.openingQuote;var b=this.closingQuote}else{var f=this.openingQuotes;var b=this.closingQuotes}var a=this.editor;var e=a.getSelection();if(Xinha.is_ie){var d=a.createRange(e);if(d.text!==""){d.text=""}d.moveStart("character",-1);if(d.text.match(/\S/)){d.moveStart("character",+1);d.text=b}else{d.moveStart("character",+1);d.text=f}}else{var d=a.createRange(e);if(!d.collapsed){a.insertNodeAtSelection(document.createTextNode(""))}if(d.startOffset>0){d.setStart(d.startContainer,d.startOffset-1)}if(d.toString().match(/[^\s\xA0]/)){d.collapse(false);a.insertNodeAtSelection(document.createTextNode(b))}else{a.insertNodeAtSelection(document.createTextNode(d.toString()[0]+f))}a.getSelection().collapseToEnd()}return false};SmartReplace.prototype.smartReplace=function(g,a,e,c,d){var b=this.editor;var h=this.editor.getSelection();var f=this.editor.createRange(h);if(Xinha.is_ie){f.moveStart("character",-a);if(f.text.match(e)){f.text=c;if(d){Xinha._stopEvent(g);return false}}}else{if(f.startOffset>1){f.setStart(f.startContainer,f.startOffset-a)}if(f.toString().match(e)){this.editor.insertNodeAtSelection(document.createTextNode(c));f.deleteContents();f.collapse(true);if(d){Xinha._stopEvent(g);return false}}b.getSelection().collapseToEnd()}return true};SmartReplace.prototype.replaceAll=function(){var g=["&quot;",String.fromCharCode(8220),String.fromCharCode(8221),String.fromCharCode(8222),String.fromCharCode(187),String.fromCharCode(171)];var e=["'",String.fromCharCode(8216),String.fromCharCode(8217),String.fromCharCode(8218),String.fromCharCode(8250),String.fromCharCode(8249)];var d=this.editor.getHTML();var h=new RegExp("(\\s|^|>)("+g.join("|")+")(\\S)","g");d=d.replace(h,"$1"+this.openingQuotes+"$3");var c=new RegExp("(\\s|^|>)("+e.join("|")+")(\\S)","g");d=d.replace(c,"$1"+this.openingQuote+"$3");var b=new RegExp("(\\S)("+g.join("|")+")","g");d=d.replace(b,"$1"+this.closingQuotes);var f=new RegExp("(\\S)("+e.join("|")+")","g");d=d.replace(f,"$1"+this.closingQuote);var a=new RegExp("( |&nbsp;)(-)( |&nbsp;)","g");d=d.replace(a," "+String.fromCharCode(8211)+" ");this.editor.setHTML(d)};SmartReplace.prototype.buttonPress=function(c,d){var a=this;if(this.dialog.rootElem.style.display!="none"){return this.dialog.hide()}var e=function(){var f=a.dialog.hide();a.toggleActivity((f.enable)?true:false);if(f.convert){a.replaceAll();a.dialog.getElementById("convert").checked=false}};var b={enable:a.active?"on":"",convert:""};this.show(b,e)};SmartReplace.prototype.onGenerateOnce=function(){this._prepareDialog()};SmartReplace.prototype._prepareDialog=function(){var b=this;var a=this.editor;if(!this.html){Xinha._getback(Xinha.getPluginDir("SmartReplace")+"/dialog.html",function(c){b.html=c;b._prepareDialog()});return}this.dialog=new Xinha.Dialog(a,this.html,"SmartReplace",{},{modal:false});this.dialog.attachToPanel("top");this.dialog.getElementById("enable").onchange=function(){b.toggleActivity(this.checked)};this.dialog.getElementById("convert").onchange=function(){b.dialog.getElementById("ok").style.display=(this.checked)?"":"none"};this.dialog.getElementById("ok").onclick=function(){b.replaceAll();b.dialog.getElementById("convert").checked=false;this.style.display="none"};this.ready=true};SmartReplace.prototype.show=function(b){if(!this.ready){var a=this;window.setTimeout(function(){a.show(b,ok,cancel)},100);return}var a=this;this.dialog.show(b);this.dialog.onresize()};