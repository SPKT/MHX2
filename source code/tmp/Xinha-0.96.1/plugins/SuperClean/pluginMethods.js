/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
SuperClean.prototype._superClean=function(opts,obj){if(this.editor.config.SuperClean.show_dialog&&!this._dialog){this._dialog=new SuperClean.Dialog(this)}var superclean=this;var doOK=function(){superclean._dialog.dialog.getElementById("main").style.display="none";superclean._dialog.dialog.getElementById("waiting").style.display="";superclean._dialog.dialog.getElementById("buttons").style.display="none";var opts=superclean._dialog.dialog.getValues();var editor=superclean.editor;if(opts.word_clean){editor._wordClean()}var D=editor.getEditorContent();for(var filter in editor.config.SuperClean.filters){if(filter=="tidy"||filter=="word_clean"){continue}if(opts[filter]){D=SuperClean.filterFunctions[filter](D,editor)}}D=D.replace(/(style|class)="\s*"/gi,"");D=D.replace(/<(font|span)\s*>/gi,"");editor.setEditorContent(D);if(opts.tidy){var callback=function(javascriptResponse){eval("var response = "+javascriptResponse);switch(response.action){case"setHTML":editor.setEditorContent(response.value);superclean._dialog.hide();break;case"alert":superclean._dialog.dialog.getElementById("buttons").style.display="";superclean._dialog.dialog.getElementById("ok").style.display="none";superclean._dialog.dialog.getElementById("waiting").style.display="none";superclean._dialog.dialog.getElementById("alert").style.display="";superclean._dialog.dialog.getElementById("alert").innerHTML=superclean._lc(response.value);break;default:superclean._dialog.hide();break}};var args=editor.config.SuperClean.tidy_args;if(typeof args!="object"){args={}}args.content=editor.getInnerHTML();Xinha._postback(editor.config.SuperClean.tidy_handler,args,callback)}else{superclean._dialog.hide()}return true};if(this.editor.config.SuperClean.show_dialog){var inputs={};this._dialog.show(inputs,doOK)}else{var editor=this.editor;var html=editor.getEditorContent();for(var filter in editor.config.SuperClean.filters){if(filter=="tidy"){continue}html=SuperClean.filterFunctions[filter](html,editor)}html=html.replace(/(style|class)="\s*"/gi,"");html=html.replace(/<(font|span)\s*>/gi,"");editor.setEditorContent(html);if(editor.config.SuperClean.filters.tidy){SuperClean.filterFunctions.tidy(html,editor)}}};SuperClean.filterFunctions.remove_colors=function(a){a=a.replace(/color="?[^" >]*"?/gi,"");a=a.replace(/([^-])color:[^;}"']+;?/gi,"$1");return(a)};SuperClean.filterFunctions.remove_sizes=function(a){a=a.replace(/size="?[^" >]*"?/gi,"");a=a.replace(/font-size:[^;}"']+;?/gi,"");return(a)};SuperClean.filterFunctions.remove_faces=function(a){a=a.replace(/face="?[^" >]*"?/gi,"");a=a.replace(/font-family:[^;}"']+;?/gi,"");return(a)};SuperClean.filterFunctions.remove_lang=function(a){a=a.replace(/lang="?[^" >]*"?/gi,"");return(a)};SuperClean.filterFunctions.word_clean=function(b,a){a.setHTML(b);a._wordClean();return a.getInnerHTML()};SuperClean.filterFunctions.remove_fancy_quotes=function(a){a=a.replace(new RegExp(String.fromCharCode(8216),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8217),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8218),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8219),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8220),"g"),'"');a=a.replace(new RegExp(String.fromCharCode(8221),"g"),'"');a=a.replace(new RegExp(String.fromCharCode(8222),"g"),'"');a=a.replace(new RegExp(String.fromCharCode(8223),"g"),'"');return a};SuperClean.filterFunctions.tidy=function(html,editor){var callback=function(javascriptResponse){eval("var response = "+javascriptResponse);switch(response.action){case"setHTML":editor.setEditorContent(response.value);break;case"alert":alert(Xinha._lc(response.value,"SuperClean"));break}};var args=editor.config.SuperClean.tidy_args;if(typeof args!="object"){args={}}args.content=html;Xinha._postback(editor.config.SuperClean.tidy_handler,args,callback)};SuperClean.Dialog=function(b){var a=this;this.Dialog_nxtid=0;this.SuperClean=b;this.id={};this.ready=false;this.dialog=false;this._prepareDialog()};SuperClean.Dialog.prototype._prepareDialog=function(){var e=this;var f=this.SuperClean;var d=window.SuperClean.html;var g="";for(var a in this.SuperClean.editor.config.SuperClean.filters){g+="    <div>\n";var c=this.SuperClean.editor.config.SuperClean.filters[a];if(typeof c.label=="undefined"){g+='        <input type="checkbox" name="['+a+']" id="['+a+']" checked value="on" />\n';g+='        <label for="['+a+']">'+this.SuperClean.editor.config.SuperClean.filters[a]+"</label>\n"}else{g+='        <input type="checkbox" name="['+a+']" id="['+a+']" value="on"'+(c.checked?"checked":"")+" />\n";g+='        <label for="['+a+']">'+c.label+"</label>\n"}g+="    </div>\n"}d=d.replace("<!--filters-->",g);var b=this.dialog=new Xinha.Dialog(f.editor,d,"SuperClean",{width:400});this.ready=true};SuperClean.Dialog.prototype._lc=SuperClean.prototype._lc;SuperClean.Dialog.prototype.show=function(d,c,a){if(!this.ready){var e=this;window.setTimeout(function(){e.show(d,c,a)},100);return}var b=this.dialog;var e=this;if(c){this.dialog.getElementById("ok").onclick=c}else{this.dialog.getElementById("ok").onclick=function(){e.hide()}}if(a){this.dialog.getElementById("cancel").onclick=a}else{this.dialog.getElementById("cancel").onclick=function(){e.hide()}}this.SuperClean.editor.disableToolbar(["fullscreen","SuperClean"]);this.dialog.show(d);this.dialog.onresize()};SuperClean.Dialog.prototype.hide=function(){var a=this.dialog.hide();this.SuperClean.editor.enableToolbar();this.dialog.getElementById("main").style.display="";this.dialog.getElementById("buttons").style.display="";this.dialog.getElementById("waiting").style.display="none";this.dialog.getElementById("alert").style.display="none";this.dialog.getElementById("ok").style.display="";return a};