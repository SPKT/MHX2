/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
Xinha.loadStyle("menu.css","ContextMenu");function ContextMenu(a){this.editor=a}ContextMenu._pluginInfo={name:"ContextMenu",version:"1.0",developer:"Mihai Bazon",developer_url:"http://dynarch.com/mishoo/",c_owner:"dynarch.com",sponsor:"American Bible Society",sponsor_url:"http://www.americanbible.org",license:"htmlArea"};Xinha.Config.prototype.ContextMenu={disableMozillaSpellCheck:false,customHooks:{}};ContextMenu.prototype.onGenerate=function(){var a=this;var b=this.editordoc=this.editor._iframe.contentWindow.document;Xinha._addEvents(b,["contextmenu"],function(c){return a.popupMenu(Xinha.is_ie?a.editor._iframe.contentWindow.event:c)});this.currentMenu=null;if(this.editor.config.ContextMenu.disableMozillaSpellCheck){this.editordoc.body.spellcheck=false}};ContextMenu.prototype.getContextMenu=function(l){var n=this;var f=this.editor;var o=f.config;var a=[];var d=this.editor.plugins.TableOperations;if(d){d=d.instance}var k=f.hasSelectedText();if(!Xinha.is_gecko){if(k){a.push([Xinha._lc("Cut","ContextMenu"),function(){f.execCommand("cut")},null,o.btnList.cut[1]],[Xinha._lc("Copy","ContextMenu"),function(){f.execCommand("copy")},null,o.btnList.copy[1]]);a.push([Xinha._lc("Paste","ContextMenu"),function(){f.execCommand("paste")},null,o.btnList.paste[1]])}}var j=l;var e=[];var g=null;var r=null;var b=null;var h=null;var s=null;function c(i){d.buttonPress(f,i)}function p(y){var v=j;var u=v.parentNode;var x=f._doc.createElement("p");x.appendChild(f._doc.createElement("br"));u.insertBefore(x,y?v.nextSibling:v);var w=f._getSelection();var i=f._createRange(w);if(!Xinha.is_ie){w.removeAllRanges();i.selectNodeContents(x);i.collapse(true);w.addRange(i)}else{i.moveToElementText(x);i.collapse(true);i.select()}}for(;l;l=l.parentNode){var t=l.tagName;if(!t){continue}t=t.toLowerCase();switch(t){case"img":s=l;e.push(null,[Xinha._lc("_Image Properties...","ContextMenu"),function(){f._insertImage(s)},Xinha._lc("Show the image properties dialog","ContextMenu"),o.btnList.insertimage[1]]);break;case"a":g=l;e.push(null,[Xinha._lc("_Modify Link...","ContextMenu"),function(){f.config.btnList.createlink[3](f)},Xinha._lc("Current URL is","ContextMenu")+": "+g.href,o.btnList.createlink[1]],[Xinha._lc("Chec_k Link...","ContextMenu"),function(){window.open(g.href)},Xinha._lc("Opens this link in a new window","ContextMenu")],[Xinha._lc("_Remove Link...","ContextMenu"),function(){if(confirm(Xinha._lc("Please confirm that you want to unlink this element.","ContextMenu")+"\n"+Xinha._lc("Link points to:","ContextMenu")+" "+g.href)){while(g.firstChild){g.parentNode.insertBefore(g.firstChild,g)}g.parentNode.removeChild(g)}},Xinha._lc("Unlink the current element","ContextMenu")]);break;case"td":h=l;if(!d){break}e.push(null,[Xinha._lc("C_ell Properties...","ContextMenu"),function(){c("TO-cell-prop")},Xinha._lc("Show the Table Cell Properties dialog","ContextMenu"),o.btnList["TO-cell-prop"][1]],[Xinha._lc("Insert Cell After","ContextMenu"),function(){c("TO-cell-insert-after")},Xinha._lc("Insert Cell After","ContextMenu"),o.btnList["TO-cell-insert-after"][1]],[Xinha._lc("Insert Cell Before","ContextMenu"),function(){c("TO-cell-insert-before")},Xinha._lc("Insert Cell After","ContextMenu"),o.btnList["TO-cell-insert-before"][1]],[Xinha._lc("Delete Cell","ContextMenu"),function(){c("TO-cell-delete")},Xinha._lc("Delete Cell","ContextMenu"),o.btnList["TO-cell-delete"][1]],[Xinha._lc("Merge Cells","ContextMenu"),function(){c("TO-cell-merge")},Xinha._lc("Merge Cells","ContextMenu"),o.btnList["TO-cell-merge"][1]]);break;case"tr":b=l;if(!d){break}e.push(null,[Xinha._lc("Ro_w Properties...","ContextMenu"),function(){c("TO-row-prop")},Xinha._lc("Show the Table Row Properties dialog","ContextMenu"),o.btnList["TO-row-prop"][1]],[Xinha._lc("I_nsert Row Before","ContextMenu"),function(){c("TO-row-insert-above")},Xinha._lc("Insert a new row before the current one","ContextMenu"),o.btnList["TO-row-insert-above"][1]],[Xinha._lc("In_sert Row After","ContextMenu"),function(){c("TO-row-insert-under")},Xinha._lc("Insert a new row after the current one","ContextMenu"),o.btnList["TO-row-insert-under"][1]],[Xinha._lc("_Delete Row","ContextMenu"),function(){c("TO-row-delete")},Xinha._lc("Delete the current row","ContextMenu"),o.btnList["TO-row-delete"][1]]);break;case"table":r=l;if(!d){break}e.push(null,[Xinha._lc("_Table Properties...","ContextMenu"),function(){c("TO-table-prop")},Xinha._lc("Show the Table Properties dialog","ContextMenu"),o.btnList["TO-table-prop"][1]],[Xinha._lc("Insert _Column Before","ContextMenu"),function(){c("TO-col-insert-before")},Xinha._lc("Insert a new column before the current one","ContextMenu"),o.btnList["TO-col-insert-before"][1]],[Xinha._lc("Insert C_olumn After","ContextMenu"),function(){c("TO-col-insert-after")},Xinha._lc("Insert a new column after the current one","ContextMenu"),o.btnList["TO-col-insert-after"][1]],[Xinha._lc("De_lete Column","ContextMenu"),function(){c("TO-col-delete")},Xinha._lc("Delete the current column","ContextMenu"),o.btnList["TO-col-delete"][1]]);break;case"body":e.push(null,[Xinha._lc("Justify Left","ContextMenu"),function(){f.execCommand("justifyleft")},null,o.btnList.justifyleft[1]],[Xinha._lc("Justify Center","ContextMenu"),function(){f.execCommand("justifycenter")},null,o.btnList.justifycenter[1]],[Xinha._lc("Justify Right","ContextMenu"),function(){f.execCommand("justifyright")},null,o.btnList.justifyright[1]],[Xinha._lc("Justify Full","ContextMenu"),function(){f.execCommand("justifyfull")},null,o.btnList.justifyfull[1]]);break}}if(k&&!g){a.push(null,[Xinha._lc("Make lin_k...","ContextMenu"),function(){f.config.btnList.createlink[3](f)},Xinha._lc("Create a link","ContextMenu"),o.btnList.createlink[1]])}if(f.config.ContextMenu.customHooks[j.tagName.toLowerCase()]){var m=f.config.ContextMenu.customHooks[j.tagName.toLowerCase()];for(var q=0;q<m.length;++q){a.push(m[q])}}for(var q=0;q<e.length;++q){a.push(e[q])}if(!/html|body/i.test(j.tagName)){a.push(null,[Xinha._lc({string:"Remove the $elem Element...",replace:{elem:"&lt;"+j.tagName+"&gt;"}},"ContextMenu"),function(){if(confirm(Xinha._lc("Please confirm that you want to remove this element:","ContextMenu")+" "+j.tagName)){var i=j;var u=i.parentNode;u.removeChild(i);if(Xinha.is_gecko){if(u.tagName.toLowerCase()=="td"&&!u.hasChildNodes()){u.appendChild(f._doc.createElement("br"))}f.forceRedraw();f.focusEditor();f.updateToolbar();if(r){var v=r.style.borderCollapse;r.style.borderCollapse="collapse";r.style.borderCollapse="separate";r.style.borderCollapse=v}}}},Xinha._lc("Remove this node from the document","ContextMenu")],[Xinha._lc("Insert paragraph before","ContextMenu"),function(){p(false)},Xinha._lc("Insert a paragraph before the current node","ContextMenu")],[Xinha._lc("Insert paragraph after","ContextMenu"),function(){p(true)},Xinha._lc("Insert a paragraph after the current node","ContextMenu")])}if(!a[0]){a.shift()}return a};ContextMenu.prototype.popupMenu=function(F){var v=this;if(this.currentMenu){this.closeMenu()}function A(i){var t={x:i.offsetLeft,y:i.offsetTop};if(i.offsetParent){var h=A(i.offsetParent);t.x+=h.x;t.y+=h.y}return t}function g(i){i||(i=window.event);if(!v.currentMenu){alert(Xinha._lc("How did you get here? (Please report!)","ContextMenu"));return false}var h=Xinha.is_ie?i.srcElement:i.target;for(;h!=null&&h!=v.currentMenu;h=h.parentNode){}if(h==null){v.closeMenu()}}var s=[];function z(x){x||(x=window.event);Xinha._stopEvent(x);if(x.keyCode==27){v.closeMenu();return false}var w=String.fromCharCode(Xinha.is_ie?x.keyCode:x.charCode).toLowerCase();for(var t=s.length;--t>=0;){var h=s[t];if(h[0].toLowerCase()==w){h[1].__msh.activate()}}}v.closeMenu=function(){v.currentMenu.parentNode.removeChild(v.currentMenu);v.currentMenu=null;Xinha._removeEvent(document,"mousedown",g);Xinha._removeEvent(v.editordoc,"mousedown",g);if(s.length>0){Xinha._removeEvent(v.editordoc,"keypress",z)}if(Xinha.is_ie){v.iePopup.hide()}};var u=Xinha.is_ie?F.srcElement:F.target;var j=A(v.editor._htmlArea);var o=F.clientX+j.x;var n=F.clientY+j.y;var r;var H;if(!Xinha.is_ie){H=document}else{var b=this.iePopup=window.createPopup();H=b.document;H.open();H.write("<html><head><style type='text/css'>@import url("+Xinha.getPluginDir("ContextMenu")+"/menu.css); html, body { padding: 0px; margin: 0px; overflow: hidden; border: 0px; }</style></head><body unselectable='yes'></body></html>");H.close()}r=H.createElement("div");if(Xinha.is_ie){r.unselectable="on"}r.oncontextmenu=function(){return false};r.className="htmlarea-context-menu";if(!Xinha.is_ie){r.style.visibility="hidden";r.style.left=r.style.top="-200px"}H.body.appendChild(r);var D=H.createElement("table");r.appendChild(D);D.cellSpacing=0;D.cellPadding=0;var d=H.createElement("tbody");D.appendChild(d);var l=this.getContextMenu(u);for(var B=0;B<l.length;++B){var a=l[B];var E=H.createElement("tr");d.appendChild(E);if(Xinha.is_ie){E.unselectable="on"}else{E.onmousedown=function(h){Xinha._stopEvent(h);return false}}if(!a){E.className="separator";var k=H.createElement("td");k.className="icon";var c=">";if(Xinha.is_ie){k.unselectable="on";c=" unselectable='on' style='height=1px'>&nbsp;"}k.innerHTML="<div"+c+"</div>";var f=k.cloneNode(true);f.className="label";E.appendChild(k);E.appendChild(f)}else{var m=a[0];E.className="item";E.__msh={item:E,label:m,action:a[1],tooltip:a[2]||null,icon:a[3]||null,activate:function(){v.closeMenu();v.editor.focusEditor();this.action()}};m=m.replace(/_([a-zA-Z0-9])/,"<u>$1</u>");if(m!=a[0]){s.push([RegExp.$1,E])}m=m.replace(/__/,"_");var f=H.createElement("td");if(Xinha.is_ie){f.unselectable="on"}E.appendChild(f);f.className="icon";if(E.__msh.icon){var q=Xinha.makeBtnImg(E.__msh.icon,H);f.appendChild(q)}var e=H.createElement("td");if(Xinha.is_ie){e.unselectable="on"}E.appendChild(e);e.className="label";e.innerHTML=m;E.onmouseover=function(){this.className+=" hover";v.editor._statusBarTree.innerHTML=this.__msh.tooltip||"&nbsp;"};E.onmouseout=function(){this.className="item"};E.oncontextmenu=function(h){this.__msh.activate();if(!Xinha.is_ie){Xinha._stopEvent(h)}return false};E.onmouseup=function(i){var h=(new Date()).getTime();if(h-v.timeStamp>500){this.__msh.activate()}if(!Xinha.is_ie){Xinha._stopEvent(i)}return false}}}if(!Xinha.is_ie){var G=10;if(n+r.offsetHeight+G>window.innerHeight){n=window.innerHeight-r.offsetHeight-G}if(o+r.offsetWidth+G>window.innerWidth){o=window.innerWidth-r.offsetWidth-G}r.style.left=o+"px";r.style.top=n+"px";r.style.visibility="visible"}else{this.iePopup.show(F.screenX,F.screenY,300,50);var p=r.offsetWidth;var C=r.offsetHeight;this.iePopup.show(F.screenX,F.screenY,p,C)}this.currentMenu=r;this.timeStamp=(new Date()).getTime();Xinha._addEvent(document,"mousedown",g);Xinha._addEvent(this.editordoc,"mousedown",g);if(s.length>0){Xinha._addEvent(this.editordoc,"keypress",z)}Xinha._stopEvent(F);return false};