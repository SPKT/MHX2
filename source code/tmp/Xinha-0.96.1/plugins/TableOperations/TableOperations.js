/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
Xinha.Config.prototype.TableOperations={showButtons:true};function TableOperations(d){this.editor=d;var b=d.config;var h=TableOperations.btnList;var c=this;b.removeToolbarElement(" inserttable toggleborders ");var a=["linebreak","inserttable","toggleborders"];for(var f=0;f<h.length;++f){var e=h[f];if(!e){if(b.TableOperations.showButtons){a.push("separator")}}else{var g="TO-"+e[0];b.registerButton(g,Xinha._lc(e[2],"TableOperations"),d.imgURL(e[0]+".gif","TableOperations"),false,function(i,j){c.buttonPress(i,j)},e[1]);if(b.TableOperations.showButtons){a.push(g)}}}b.toolbar.push(a);if(typeof PopupWin=="undefined"){Xinha._loadback(_editor_url+"modules/Dialogs/popupwin.js")}if(typeof Xinha.InlineStyler=="undefined"){Xinha._loadback(_editor_url+"modules/InlineStyler/InlineStyler.js")}}TableOperations._pluginInfo={name:"TableOperations",version:"1.0",developer:"Mihai Bazon",developer_url:"http://dynarch.com/mishoo/",c_owner:"Mihai Bazon",sponsor:"Zapatec Inc.",sponsor_url:"http://www.bloki.com",license:"htmlArea"};TableOperations.prototype._lc=function(a){return Xinha._lc(a,"TableOperations")};TableOperations.prototype.getClosest=function(d){var b=this.editor;var a=b.getAllAncestors();var c=null;d=(""+d).toLowerCase();for(var e=0;e<a.length;++e){var f=a[e];if(f.tagName.toLowerCase()==d){c=f;break}}return c};TableOperations.prototype.buttonPress=function(l,m){this.editor=l;var g=Xinha.is_gecko?"<br />":"";function h(I){var H=I.getElementsByTagName("td");for(var G=H.length;--G>=0;){var J=H[G];J.rowSpan=1;J.innerHTML=g}}function B(L){var K=parseInt(""+L.rowSpan);var J=parseInt(""+L.colSpan);L.rowSpan=1;b=L.parentNode;var H=b.rowIndex;var i=b.parentNode.rows;var G=L.cellIndex;while(--K>0){b=i[++H];var I=l._doc.createElement("td");I.colSpan=L.colSpan;I.innerHTML=g;b.insertBefore(I,b.cells[G])}l.forceRedraw();l.updateToolbar()}function a(I){var H=parseInt(""+I.colSpan);I.colSpan=1;b=I.parentNode;var G=I.nextSibling;while(--H>0){var i=l._doc.createElement("td");i.rowSpan=I.rowSpan;i.innerHTML=g;b.insertBefore(i,G)}l.forceRedraw();l.updateToolbar()}function F(I){var H=parseInt(""+I.colSpan);a(I);var i=I.parentNode.cells;var G=I.cellIndex;while(H-->0){B(i[G++])}}function C(i){var G=i.nextSibling;while(G&&G.nodeType!=1){G=G.nextSibling}if(!G){G=i.previousSibling;while(G&&G.nodeType!=1){G=G.previousSibling}}if(!G){G=i.parentNode}l.selectNodeContents(G)}function o(T,N,P,H,J){var U=[];var S=[];try{for(x=P;x<P+J;x++){var V=T.rows[x];for(K=N;K<N+H;K++){if(V.cells[K].colSpan>1||V.cells[K].rowSpan>1){F(V.cells[K])}S.push(V.cells[K])}if(S.length>0){U.push(S);S=[]}}}catch(O){alert("Invalid selection");return false}var i=U[0][0].parentNode.rowIndex;var G=U[U.length-1][0].parentNode.rowIndex;var M=U[U.length-1][0].rowSpan;var L="";for(x=0;x<U.length;++x){var S=U[x];for(var K=0;K<S.length;++K){var R=S[K];L+=R.innerHTML;(x||K)&&(R.parentNode.removeChild(R))}}var I=U[0][0];I.innerHTML=L;I.rowSpan=G-i+M;var Q=0;for(K=0;K<U[0].length;K++){Q+=U[0][K].colSpan}I.colSpan=Q;l.selectNodeContents(I);l.forceRedraw();l.focusEditor()}switch(m){case"TO-row-insert-above":case"TO-row-insert-under":var b=this.getClosest("tr");if(!b){break}var r=b.cloneNode(true);h(r);b.parentNode.insertBefore(r,/under/.test(m)?b.nextSibling:b);l.forceRedraw();l.focusEditor();break;case"TO-row-delete":var b=this.getClosest("tr");if(!b){break}var u=b.parentNode;if(u.rows.length==1){alert(Xinha._lc("Xinha cowardly refuses to delete the last row in table.","TableOperations"));break}C(b);u.removeChild(b);l.forceRedraw();l.focusEditor();l.updateToolbar();break;case"TO-row-split":var n=this.getClosest("td");if(!n){break}B(n);break;case"TO-col-insert-before":case"TO-col-insert-after":var n=this.getClosest("td");if(!n){break}var q=n.parentNode.parentNode.rows;var k=n.cellIndex;var p=(n.parentNode.cells.length==k+1);for(var x=q.length;--x>=0;){var b=q[x];var w=l._doc.createElement("td");w.innerHTML=g;if(p&&Xinha.is_ie){b.insertBefore(w)}else{var j=b.cells[k+(/after/.test(m)?1:0)];b.insertBefore(w,j)}}l.focusEditor();break;case"TO-col-split":var n=this.getClosest("td");if(!n){break}a(n);break;case"TO-col-delete":var n=this.getClosest("td");if(!n){break}var k=n.cellIndex;if(n.parentNode.cells.length==1){alert(Xinha._lc("Xinha cowardly refuses to delete the last column in table.","TableOperations"));break}C(n);var q=n.parentNode.parentNode.rows;for(var x=q.length;--x>=0;){var b=q[x];b.removeChild(b.cells[k])}l.forceRedraw();l.focusEditor();l.updateToolbar();break;case"TO-cell-split":var n=this.getClosest("td");if(!n){break}F(n);break;case"TO-cell-insert-before":case"TO-cell-insert-after":var n=this.getClosest("td");if(!n){break}var b=n.parentNode;var w=l._doc.createElement("td");w.innerHTML=g;b.insertBefore(w,/after/.test(m)?n.nextSibling:n);l.forceRedraw();l.focusEditor();break;case"TO-cell-delete":var n=this.getClosest("td");if(!n){break}if(n.parentNode.cells.length==1){alert(Xinha._lc("Xinha cowardly refuses to delete the last cell in row.","TableOperations"));break}C(n);n.parentNode.removeChild(n);l.forceRedraw();l.updateToolbar();break;case"TO-cell-merge":var v=l._getSelection();if(!Xinha.is_ie&&v.rangeCount>1){var t=v.getRangeAt(0);var n=t.startContainer.childNodes[t.startOffset];var b=n.parentNode;var d=n.cellIndex;var s=b.rowIndex;var A=0;var E=s;var e=0;var D=0;var f,z;for(x=0;x<v.rangeCount;x++){t=v.getRangeAt(x);f=t.startContainer.childNodes[t.startOffset];z=f.parentNode;if(z.rowIndex!=E){E=z.rowIndex;D=0}D+=f.colSpan;if(D>e){e=D}if(z.rowIndex+f.rowSpan-1>A){A=z.rowIndex+f.rowSpan-1}}var c=A-s+1;var y=b.parentNode;o(y,d,s,e,c)}else{var n=this.getClosest("td");if(!n){alert(Xinha._lc("Please click into some cell","TableOperations"));break}var b=n.parentNode;var d=n.cellIndex;var s=b.rowIndex;this.dialogMerge(o,d,s)}break;case"TO-table-prop":this.dialogTableProperties();break;case"TO-row-prop":this.dialogRowCellProperties(false);break;case"TO-cell-prop":this.dialogRowCellProperties(true);break;default:alert("Button ["+m+"] not yet implemented")}};TableOperations.btnList=[["table-prop","table","Table properties"],null,["row-prop","tr","Row properties"],["row-insert-above","tr","Insert row before"],["row-insert-under","tr","Insert row after"],["row-delete","tr","Delete row"],["row-split","td[rowSpan!=1]","Split row"],null,["col-insert-before","td","Insert column before"],["col-insert-after","td","Insert column after"],["col-delete","td","Delete column"],["col-split","td[colSpan!=1]","Split column"],null,["cell-prop","td","Cell properties"],["cell-insert-before","td","Insert cell before"],["cell-insert-after","td","Insert cell after"],["cell-delete","td","Delete cell"],["cell-merge","tr","Merge cells"],["cell-split","td[colSpan!=1,rowSpan!=1]","Split cell"]];TableOperations.prototype.dialogMerge=function(h,g,e){var f=this.getClosest("table");var c=this;var b=this.editor;if(!this.dialogMergeCellsHtml){Xinha._getback(Xinha.getPluginDir("TableOperations")+"/popups/dialogMergeCells.html",function(i){c.dialogMergeCellsHtml=i;c.dialogMerge(h,g,e)});return}if(!this.dialogMergeCells){this.dialogMergeCells=new Xinha.Dialog(b,this.dialogMergeCellsHtml,"TableOperations",{width:400});this.dialogMergeCells.getElementById("cancel").onclick=function(){c.dialogMergeCells.hide()}}var d=this.dialogMergeCells;function a(){d.hide();no_cols=parseInt(d.getElementById("f_cols").value,10)+1;no_rows=parseInt(d.getElementById("f_rows").value,10)+1;h(f,g,e,no_cols,no_rows);return}this.dialogMergeCells.getElementById("ok").onclick=a;this.dialogMergeCells.show();this.dialogMergeCells.getElementById("f_cols").focus()};TableOperations.prototype.dialogTableProperties=function(){var l=this.getClosest("table");var k=this;var e=this.editor;if(!this.dialogTablePropertiesHtml){Xinha._getback(Xinha.getPluginDir("TableOperations")+"/popups/dialogTable.html",function(m){k.dialogTablePropertiesHtml=m;k.dialogTableProperties()});return}if(!this.dialogTable){this.dialogTable=new Xinha.Dialog(e,this.dialogTablePropertiesHtml,"TableOperations",{width:440});this.dialogTable.getElementById("cancel").onclick=function(){k.dialogTable.hide()}}var b=this.dialogTable;var f=new Xinha.InlineStyler(l,this.editor,b);function j(){var p=b.hide();f.applyStyle(p);for(var n in p){if(typeof p[n]=="function"){continue}var o=p[n];if(typeof o=="object"&&o!=null&&o.tagName){o=o.value}switch(n){case"caption":if(/\S/.test(o)){var m=l.getElementsByTagName("caption")[0];if(!m){m=b.editor._doc.createElement("caption");l.insertBefore(m,l.firstChild)}m.innerHTML=o}else{var m=l.getElementsByTagName("caption")[0];if(m){m.parentNode.removeChild(m)}}break;case"summary":l.summary=o;break;case"align":l.align=o;break;case"spacing":l.cellSpacing=o;break;case"padding":l.cellPadding=o;break;case"borders":l.border=o;break;case"frames":l.frame=o;break;case"rules":l.rules=o;break}}k.editor.forceRedraw();k.editor.focusEditor();k.editor.updateToolbar();var q=l.style.borderCollapse;l.style.borderCollapse="collapse";l.style.borderCollapse="separate";l.style.borderCollapse=q}var c=f.createStyleLayoutFieldset();var d=b.getElementById("TO_layout");d.replaceChild(c,d.firstChild);var h=f.createStyleFieldset();d=b.getElementById("TO_style");d.replaceChild(h,d.firstChild);this.dialogTable.getElementById("ok").onclick=j;var i={};var g=l.getElementsByTagName("caption")[0];if(g){i.caption=g.innerHTML}else{i.caption=""}i.summary=l.summary;i.spacing=l.cellSpacing;i.padding=l.cellPadding;var a=l.border;i.frames=l.frame;i.rules=l.rules;this.dialogTable.show(i)};TableOperations.prototype.dialogRowCellProperties=function(h){var e=this.getClosest(h?"td":"tr");var k=this.getClosest("table");var j=this;var d=this.editor;if(!j.dialogRowCellPropertiesHtml){Xinha._getback(Xinha.getPluginDir("TableOperations")+"/popups/dialogRowCell.html",function(l){j.dialogRowCellPropertiesHtml=l;j.dialogRowCellProperties(h)});return}if(!this.dialogRowCell){this.dialogRowCell=new Xinha.Dialog(d,j.dialogRowCellPropertiesHtml,"TableOperations",{width:440});this.dialogRowCell.getElementById("cancel").onclick=function(){j.dialogRowCell.hide()}}var b=this.dialogRowCell;b.getElementById("title").innerHTML=h?Xinha._lc("Cell Properties","TableOperations"):Xinha._lc("Row Properties","TableOperations");var f=new Xinha.InlineStyler(e,j.editor,b);function i(){var l=b.hide();f.applyStyle(l);j.editor.forceRedraw();j.editor.focusEditor();j.editor.updateToolbar();var m=k.style.borderCollapse;k.style.borderCollapse="collapse";k.style.borderCollapse="separate";k.style.borderCollapse=m}var a=f.createStyleLayoutFieldset();var c=b.getElementById("TO_layout");c.replaceChild(a,c.firstChild);var g=f.createStyleFieldset();c=b.getElementById("TO_style");c.replaceChild(g,c.firstChild);this.dialogRowCell.getElementById("ok").onclick=i;this.dialogRowCell.show()};