/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
MootoolsFileManager.prototype.OpenImageManager=function(c){var b=this.editor;var a=this;var d=null;if(typeof c=="undefined"){c=b.getParentElement();if(c&&!/^img$/i.test(c.tagName)){c=null}}if(c){d={f_url:Xinha.is_ie?c.src:c.src,f_alt:c.alt,f_border:c.style.borderWidth?c.style.borderWidth:c.border,f_align:c.hasAttribute("align")?c.align:null,f_padding:c.style.padding,f_margin:c.style.margin,f_width:c.hasAttribute("width")?c.width:null,f_height:c.hasAttribute("height")?c.height:null,f_backgroundColor:c.style.backgroundColor,f_borderColor:c.style.borderColor,f_hspace:c.hspace&&c.hspace!="-1"?parseInt(c.hspace):null,f_vspace:c.vspace&&c.vspace!="-1"?parseInt(c.vspace):null};d.f_border=this.shortSize(d.f_border);d.f_padding=this.shortSize(d.f_padding);d.f_margin=this.shortSize(d.f_margin);d.f_backgroundColor=this.convertToHex(d.f_backgroundColor);d.f_borderColor=this.convertToHex(d.f_borderColor)}this.current_image=c;this.current_attributes=d;if(!this.ImageManagerWidget){this.ImageManagerWidget=new FileManager({url:this.editor.config.MootoolsFileManager.backend+"__function=image-manager&",assetBasePath:Xinha.getPluginDir("MootoolsFileManager")+"/mootools-filemanager/Assets",language:_editor_lang,selectable:true,upload:this.phpcfg.allow_images_upload,uploadAuthData:this.editor.config.MootoolsFileManager.backend_data,onComplete:function(f,e){a.ImageManagerReturn(f,e)},onHide:function(){if(this.swf&&this.swf.box){this.swf.box.style.display="none"}},onShow:function(){if(this.swf&&this.swf.box){this.swf.box.style.display=""}},onDetails:function(e){this.info.adopt(a.ImageManagerAttributes(e));return true},onHidePreview:function(){$(a.ImageManagerAttributes().table).dispose();return true}})}this.ImageManagerWidget.show()};MootoolsFileManager.prototype.ImageManagerAttributes=function(b){var a=this;a._LastImageDetails=b;function d(f){var h=a._ImageManagerAttributesTable.getElementsByTagName("input");for(var g=0;g<h.length;g++){if(h[g].name==f){return h[g]}}var h=a._ImageManagerAttributesTable.getElementsByTagName("select");for(var g=0;g<h.length;g++){if(h[g].name==f){return h[g]}}return null}function c(e,g){for(var f=0;f<d(e).options.length;f++){if(d(e).options[f].value==g){d(e).selectedIndex=f}}}if(!this._ImageManagerAttributesTable){this._ImageManagerAttributesTable=(function(){var n=document.createElement("table");n.className="filemanager-extended-options";var i=n.appendChild(document.createElement("tbody"));var k=i.appendChild(document.createElement("tr"));var f=k.appendChild(document.createElement("th"));var m=f.appendChild(document.createTextNode("Description:"));var g=k.appendChild(document.createElement("td"));var l=g.appendChild(document.createElement("input"));g.colSpan=6;l.name="f_alt";l.type="text";f.className=g.className="filemanager-f_alt";var k=i.appendChild(document.createElement("tr"));var f=k.appendChild(document.createElement("th"));var m=f.appendChild(document.createTextNode("Width:"));var g=k.appendChild(document.createElement("td"));var l=g.appendChild(document.createElement("input"));l.name="f_width";l.size=4;l.type="text";f.className=g.className="filemanager-f_width";var g=k.appendChild(document.createElement("td"));g.rowSpan=2;var e=g.appendChild(document.createElement("div"));e.style.position="relative";var h=e.appendChild(document.createElement("img"));h.src="/plugins/ImageManager/img/locked.gif";h.width=25;h.height=32;h.alt="Constrain Proportions";h.style.verticalAlign="middle";var l=document.createElement("input");l.type="checkbox";l.name="f_constrain";l.style.position="absolute";l.style.top="8px";l.style.left="0px";l.value="on";l.checked=true;e.appendChild(l);g.className="filemanager-f_constrain";if(a.phpcfg.UseHSpaceVSpace){var f=k.appendChild(document.createElement("th"));var m=f.appendChild(document.createTextNode("Margin:"));var g=k.appendChild(document.createElement("td"));var l=g.appendChild(document.createElement("input"));l.name="f_hspace";l.size=3;l.type="text";g.appendChild(document.createTextNode(" x "));var l=g.appendChild(document.createElement("input"));l.name="f_vspace";l.size=3;l.type="text";g.appendChild(document.createTextNode(" px "));f.className=g.className="filemanager-f_hspace filemanager-f_vspace"}else{var f=k.appendChild(document.createElement("th"));var m=f.appendChild(document.createTextNode("Margin:"));var g=k.appendChild(document.createElement("td"));var l=g.appendChild(document.createElement("input"));l.name="f_margin";l.size=3;l.type="text";g.appendChild(document.createTextNode(" px "));f.className=g.className="filemanager-f_margin"}var k=i.appendChild(document.createElement("tr"));var f=k.appendChild(document.createElement("th"));var m=f.appendChild(document.createTextNode("Height:"));var g=k.appendChild(document.createElement("td"));var l=g.appendChild(document.createElement("input"));l.name="f_height";l.size=4;l.type="text";f.className=g.className="filemanager-f_width";var f=k.appendChild(document.createElement("th"));var m=f.appendChild(document.createTextNode("Padding:"));var g=k.appendChild(document.createElement("td"));var l=g.appendChild(document.createElement("input"));l.name="f_padding";l.size=3;l.type="text";g.appendChild(document.createTextNode(" px "));f.className=g.className="filemanager-f_padding";var f=k.appendChild(document.createElement("th"));var m=f.appendChild(document.createTextNode("Colour:"));var g=k.appendChild(document.createElement("td"));var l=g.appendChild(document.createElement("input"));l.name="f_backgroundColor";l.size=7;l.type="text";new Xinha.colorPicker.InputBinding(l);f.className=g.className="filemanager-f_backgroundColor";var k=i.appendChild(document.createElement("tr"));var f=k.appendChild(document.createElement("th"));var m=f.appendChild(document.createTextNode("Alignment:"));var g=k.appendChild(document.createElement("td"));g.colSpan=2;var l=g.appendChild(document.createElement("select"));l.name="f_align";l.title="Positioning of this image";l.options[0]=new Option("",true,true);l.options[1]=new Option("Left");l.options[2]=new Option("Right");l.options[3]=new Option("Top");l.options[4]=new Option("Middle");l.options[5]=new Option("Bottom");f.className=g.className="filemanager-f_align";var f=k.appendChild(document.createElement("th"));var m=f.appendChild(document.createTextNode("Border:"));var g=k.appendChild(document.createElement("td"));var l=g.appendChild(document.createElement("input"));l.name="f_border";l.size=3;l.type="text";g.appendChild(document.createTextNode(" px "));f.className=g.className="filemanager-f_border";var f=k.appendChild(document.createElement("th"));var m=f.appendChild(document.createTextNode("Colour:"));var g=k.appendChild(document.createElement("td"));var l=g.appendChild(document.createElement("input"));l.name="f_borderColor";l.size=7;l.type="text";new Xinha.colorPicker.InputBinding(l);f.className=g.className="filemanager-f_borderColor";var e=document.createElement("div");var j=document.createElement("h2");j.appendChild(document.createTextNode("Image Attributes"));e.appendChild(j);e.appendChild(n);return e})();d("f_width").onkeyup=function(){if(!d("f_constrain").checked){return true}if(!d("f_width").value){d("f_width").value="";d("f_height").value=""}else{if(d("f_height").value&&a._LastImageDetails){d("f_height").value=a.ScaleImage(a._LastImageDetails,{width:d("f_width").value,height:null}).height}else{if(!a._LastImageDetails){d("f_height").value=""}}}return true};d("f_height").onkeyup=function(){if(!d("f_constrain").checked){return true}if(!d("f_height").value){d("f_width").value="";d("f_height").value=""}else{if(d("f_width").value&&a._LastImageDetails){d("f_width").value=a.ScaleImage(a._LastImageDetails,{width:null,height:d("f_height").value}).width}else{if(!a._LastImageDetails){d("f_width").value=""}}}return true};d("f_constrain").onclick=function(){if(this.checked&&d("f_width").value&&d("f_height").value){var e=a.ScaleImage(a._LastImageDetails,{width:d("f_width").value,height:d("f_height").value});d("f_width").value=e.width;d("f_height").value=e.height}}}if(this.current_attributes){d("f_alt").value=this.current_attributes.f_alt;d("f_border").value=this.current_attributes.f_border;c("f_align",this.current_attributes.f_align);d("f_padding").value=this.current_attributes.f_padding;if(d("f_margin")){d("f_margin").value=this.current_attributes.f_margin}d("f_backgroundColor").value=this.current_attributes.f_backgroundColor;d("f_borderColor").value=this.current_attributes.f_borderColor;if(d("f_hspace")){d("f_hspace").value=this.current_attributes.f_hspace}if(d("f_vspace")){d("f_vspace").value=this.current_attributes.f_vspace}d("f_width").value=this.current_attributes.f_width?this.current_attributes.f_width:"";d("f_height").value=this.current_attributes.f_height?this.current_attributes.f_height:"";this.current_attributes=null}if(!b){var b={f_alt:d("f_alt").value,f_border:d("f_border").value,f_align:d("f_align").options[d("f_align").selectedIndex].value,f_padding:d("f_padding").value,f_margin:d("f_margin")?d("f_margin").value:null,f_backgroundColor:d("f_backgroundColor").value,f_borderColor:d("f_borderColor").value,f_hspace:d("f_hspace")?d("f_hspace").value:null,f_vspace:d("f_vspace")?d("f_vspace").value:null,f_width:d("f_width").value,f_height:d("f_height").value,table:this._ImageManagerAttributesTable};return b}if((d("f_width").value&&d("f_width").value!=b.width)||(d("f_height").value&&d("f_height").value!=b.height)){new Dialog("This image is a different size, would you like to use the new size?",{language:{confirm:"Shrink/Grow To Fit",decline:"Fullsize"},buttons:["confirm","decline"],onConfirm:function(){if(d("f_constrain").checked){var e=a.ScaleImage(b,{width:d("f_width").value,height:d("f_height").value});d("f_width").value=d("f_width").value?e.width:"";d("f_height").value=d("f_height").value?e.height:""}},onDecline:function(){d("f_width").value="";d("f_height").value=""}})}d("f_align").style.visibility="";return this._ImageManagerAttributesTable};MootoolsFileManager.prototype.ImageManagerReturn=function(j,c){var a=this.editor;var i=this;var e=this.current_image;var d=i.ImageManagerAttributes();d.f_url=j;var f=e;if(!f){if(Xinha.is_ie){var b=a._getSelection();var g=a._createRange(b);a._doc.execCommand("insertimage",false,d.f_url);f=g.parentElement();if(f.tagName.toLowerCase()!="img"){f=f.previousSibling}}else{f=document.createElement("img");f.src=d.f_url;a.insertNodeAtSelection(f)}}else{f.src=d.f_url}for(field in d){var h=d[field];switch(field){case"f_alt":f.alt=h;break;case"f_border":if(h.length){f.style.borderWidth=/[^0-9]/.test(h)?h:(parseInt(h)+"px");if(f.style.borderWidth&&!f.style.borderStyle){f.style.borderStyle="solid"}}else{f.style.borderWidth="";f.style.borderStyle=""}break;case"f_borderColor":f.style.borderColor=h;break;case"f_backgroundColor":f.style.backgroundColor=h;break;case"f_padding":if(h.length){f.style.padding=/[^0-9]/.test(h)?h:(parseInt(h)+"px")}else{f.style.padding=""}break;case"f_margin":if(h.length){f.style.margin=/[^0-9]/.test(h)?h:(parseInt(h)+"px")}else{f.style.margin=""}break;case"f_align":if(f.align&&f.align!==true){f.align=h}else{f.removeAttribute("align")}break;case"f_width":if(!isNaN(parseInt(h))){f.width=parseInt(h)}else{f.removeAttribute("width")}break;case"f_height":if(!isNaN(parseInt(h))){f.height=parseInt(h)}else{f.removeAttribute("height")}break;case"f_hspace":if(!isNaN(parseInt(h))){f.hspace=parseInt(h)}else{f.removeAttribute("hspace")}break;case"f_vspace":if(!isNaN(parseInt(h))){f.vspace=parseInt(h)}else{f.removeAttribute("vspace")}break}}};