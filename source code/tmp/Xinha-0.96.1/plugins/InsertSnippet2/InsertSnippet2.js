/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
function InsertSnippet2(c){this.editor=c;var a=c.config;var b=this;a.registerButton({id:"InsertSnippet2",tooltip:this._lc("Insert Snippet"),image:c.imgURL("ed_snippet.gif","InsertSnippet2"),textMode:false,action:function(d){b.buttonPress(d)}});a.addToolbarElement("InsertSnippet2","insertimage",-1);this.snippets=null;this.categories=null;this.html=null;Xinha._getback(a.InsertSnippet2.snippets,function(e,l){var g=l.responseXML;var k=g.getElementsByTagName("c");b.categories=[];for(var f=0;f<k.length;f++){b.categories.push(k[f].getAttribute("n"))}var n=g.getElementsByTagName("s");b.snippets=[];var h,m;for(var f=0;f<n.length;f++){m={};for(var d=0;d<n[f].attributes.length;d++){m[n[f].attributes[d].nodeName]=n[f].attributes[d].nodeValue}m.html=n[f].text||n[f].textContent;b.snippets.push(m)}});Xinha.loadStyle("InsertSnippet.css","InsertSnippet2","IScss")}InsertSnippet2.prototype.onUpdateToolbar=function(){if(!this.snippets){this.editor._toolbarObjects.InsertSnippet2.state("enabled",false)}else{InsertSnippet2.prototype.onUpdateToolbar=null}};InsertSnippet2._pluginInfo={name:"InsertSnippet2",version:"1.2",developer:"Raimund Meyer",developer_url:"http://x-webservice.net",c_owner:"Raimund Meyer",sponsor:"",sponsor_url:"",license:"htmlArea"};Xinha.Config.prototype.InsertSnippet2={snippets:Xinha.getPluginDir("InsertSnippet2")+"/snippets.xml"};InsertSnippet2.prototype._lc=function(a){return Xinha._lc(a,"InsertSnippet2")};InsertSnippet2.prototype.onGenerateOnce=function(){this._prepareDialog()};InsertSnippet2.prototype._prepareDialog=function(){var d=this;if(!this.html){Xinha._getback(Xinha.getPluginDir("InsertSnippet2")+"/dialog.html",function(g){d.html=g;d._prepareDialog()});return}if(!this.snippets){setTimeout(function(){d._prepareDialog()},50);return}var c=this.editor;var f=this;this.dialog=new Xinha.Dialog(c,this.html,"InsertSnippet2",{width:800,height:400},{modal:true});Xinha._addClass(this.dialog.rootElem,"InsertSnippet2");var e=this.dialog;var a=this.dialog.main;var b=this.dialog.captionBar;this.snippetTable=e.getElementById("snippettable");this.drawCatTabs();this.drawSnippetTable();this.preparePreview();e.onresize=function(){d.resize()};this.dialog.getElementById("search").onkeyup=function(){d.search()};this.dialog.getElementById("wordbegin").onclick=function(){d.search()};this.dialog.getElementById("cancel").onclick=function(){d.dialog.hide()}};InsertSnippet2.prototype.drawSnippetTable=function(){if(!this.snippets.length){return}var m=this;var f=this.snippetTable;var n=this.snippets;while(f.hasChildNodes()){f.removeChild(f.lastChild)}var b,o,g,l,h,j,e,k,c;for(var d=0,a=0;d<n.length;d++){b=d;o=n[d]["n"];l=n[d]["c"];h=n[d]["v"];g=n[d]["html"];if(this.categoryFilter&&l!=this.categoryFilter&&this.categoryFilter!="all"){continue}j=f.insertRow(a);a++;k=0;e=j.insertCell(k);e.onmouseover=function(i){return m.preview(i||window.event)};e.onmouseout=function(){return m.preview()};e.appendChild(document.createTextNode(o));e.snID=b;e.id="cell"+b;k++;e=j.insertCell(k);e.style.whiteSpace="nowrap";c=document.createElement("button");c.snID=b;c._insAs="html";c.onclick=function(i){m.doInsert(i||window.event);return false};c.appendChild(document.createTextNode(this._lc("HTML")));c.title=this._lc("Insert as HTML");e.appendChild(c);if(h){e.appendChild(document.createTextNode(" "));var c=document.createElement("button");c.snID=b;c._insAs="variable";c.onclick=function(i){m.doInsert(i||window.event);return false};c.appendChild(document.createTextNode(this._lc("Variable")));c.title=this._lc("Insert as template variable");e.appendChild(c)}k++}};InsertSnippet2.prototype.drawCatTabs=function(){if(!this.categories.length){return}var b=this;var f=this.dialog.getElementById("cattabs");while(f.hasChildNodes()){f.removeChild(f.lastChild)}var a=1;var e=document.createElement("a");e.href="javascript:void(0);";e.appendChild(document.createTextNode(this._lc("All Categories")));e.cat="all";e.className="tab"+a;e.onclick=function(){b.categoryFilter=b.cat;b.drawCatTabs();b.drawSnippetTable();b.search()};if(!this.categoryFilter||this.categoryFilter=="all"){Xinha._addClass(e,"active");e.onclick=null}f.appendChild(e);a++;for(var d=0;d<this.categories.length;d++){var c=this.categories[d];var e=document.createElement("a");e.href="javascript:void(0);";e.appendChild(document.createTextNode(c));e.cat=c;e.className="tab"+a;e.onclick=function(){b.categoryFilter=this.cat;b.drawCatTabs();b.drawSnippetTable();b.search()};if(c==this.categoryFilter){Xinha._addClass(e,"active");e.onclick=null}f.appendChild(e);if(Xinha.is_gecko){f.appendChild(document.createTextNode(String.fromCharCode(8203)))}a=(a<16)?a+1:1}if(!this.catTabsH){this.catTabsH=f.offsetHeight}};InsertSnippet2.prototype.search=function(){var d=this.dialog.getElementById("snippettable");var j=this.dialog.getElementById("search");if(j.value){var c=j.value;c=c.replace(/\.?([*?+])/g,".$1");var b=(this.dialog.getElementById("wordbegin").checked)?"^":"";try{var k=new RegExp(b+c,"i")}catch(g){var k=null}}else{var k=null}for(var f=0;f<d.childNodes.length;f++){var h=d.childNodes[f];var a=h.firstChild.firstChild.data;if(k&&!a.match(k)){h.style.display="none"}else{h.style.display=""}}};InsertSnippet2.prototype.preview=function(a){if(!a){this.previewBody.innerHTML="";return}var c=a.target||a.srcElement;var b=c.snID;if(!this.previewBody){this.preparePreview();return}if(this.previewIframe.style.display=="none"){this.previewIframe.style.display="block"}this.previewBody.innerHTML=this.snippets[b].html};InsertSnippet2.prototype.preparePreview=function(){var b=this.editor;var a=this;var g=this.previewIframe=this.dialog.getElementById("preview_iframe");var f=null;try{if(g.contentDocument){f=g.contentDocument}else{f=g.contentWindow.document}if(!f){if(Xinha.is_gecko){setTimeout(function(){a.preparePreview(snID)},50);return false}else{throw ("ERROR: IFRAME can't be initialized.")}}}catch(e){setTimeout(function(){a.preparePreview(snID)},50)}f.open("text/html","replace");var d="<html><head><title></title>";d+='<meta http-equiv="Content-Type" content="text/html; charset='+b.config.charSet+'">\n';d+='<style type="text/css">body {background-color:#fff} </style>';if(typeof b.config.baseHref!="undefined"&&b.config.baseHref!==null){d+='<base href="'+b.config.baseHref+'"/>\n'}if(b.config.pageStyle){d+='<style type="text/css">\n'+b.config.pageStyle+"\n</style>"}if(typeof b.config.pageStyleSheets!=="undefined"){for(var c=0;c<b.config.pageStyleSheets.length;c++){if(b.config.pageStyleSheets[c].length>0){d+='<link rel="stylesheet" type="text/css" href="'+b.config.pageStyleSheets[c]+'">'}}}d+="</head>\n";d+="<body>\n";d+="</body>\n";d+="</html>";f.write(d);f.close();setTimeout(function(){a.previewBody=f.getElementsByTagName("body")[0]},100)};InsertSnippet2.prototype.buttonPress=function(a){this.dialog.toggle()};InsertSnippet2.prototype.doInsert=function(b){var d=b.target||b.srcElement;var c=this.snippets[d.snID];this.dialog.hide();var a=this.editor.config.InsertSnippet2;if(d._insAs=="variable"){this.editor.insertHTML(c.v)}else{this.editor.insertHTML(c.html)}};InsertSnippet2.prototype.resize=function(){var a=this.dialog.getElementById("insert_div");var d=this.dialog.getElementById("preview_iframe");var c={h:this.dialog.height,w:this.dialog.width};var b=c.h-90;if(this.categories.length){b-=this.catTabsH}a.style.height=d.style.height=b+"px";return true};